<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org">

<head th:replace="fragments/header :: header">
    <title>EShopper - Bootstrap Shop Template</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
</head>

<body>
    <!-- Topbar Start -->
    <div class="container-fluid" th:replace="fragments/topBar :: topBar"></div>
    <!-- Topbar End -->

    <!-- Navbar Start -->
    <div class="container-fluid">
        <div class="row border-top px-xl-5">
            <div class="col-lg-3 d-none d-lg-block">
                <a class="btn shadow-none d-flex align-items-center justify-content-between bg-primary text-white w-100" data-toggle="collapse" href="#navbar-vertical" style="height: 65px; margin-top: -1px; padding: 0 30px;">
                    <h6 class="m-0">Categories</h6>
                    <i class="fa fa-angle-down text-dark"></i>
                </a>
                <nav class="collapse position-absolute navbar navbar-vertical navbar-light align-items-start p-0 border border-top-0 border-bottom-0 bg-light" id="navbar-vertical" style="width: calc(100% - 30px); z-index: 1;">
                    <div class="navbar-nav w-100 overflow-hidden" style="height: 410px">
                        <div class="nav-item dropdown">
                            <a href="#" class="nav-link" data-toggle="dropdown">Dresses <i class="fa fa-angle-down float-right mt-1"></i></a>
                            <div class="dropdown-menu position-absolute bg-secondary border-0 rounded-0 w-100 m-0">
                                <a href="" class="dropdown-item">Men's Dresses</a>
                                <a href="" class="dropdown-item">Women's Dresses</a>
                                <a href="" class="dropdown-item">Baby's Dresses</a>
                            </div>
                        </div>
                        <a href="" class="nav-item nav-link">Shirts</a>
                        <a href="" class="nav-item nav-link">Jeans</a>
                        <a href="" class="nav-item nav-link">Swimwear</a>
                        <a href="" class="nav-item nav-link">Sleepwear</a>
                        <a href="" class="nav-item nav-link">Sportswear</a>
                        <a href="" class="nav-item nav-link">Jumpsuits</a>
                        <a href="" class="nav-item nav-link">Blazers</a>
                        <a href="" class="nav-item nav-link">Jackets</a>
                        <a href="" class="nav-item nav-link">Shoes</a>
                    </div>
                </nav>
            </div>
            <div class="col-lg-9">
                <nav class="navbar navbar-expand-lg bg-light navbar-light py-3 py-lg-0 px-0" th:replace="fragments/navBar :: navBar"></nav>
            </div>
        </div>
    </div>
    <!-- Navbar End -->


    <!-- Page Header Start -->
    <div class="container-fluid bg-secondary mb-5">
        <div class="d-flex flex-column align-items-center justify-content-center" style="min-height: 300px">
            <h1 class="font-weight-semi-bold text-uppercase mb-3">Checkout</h1>
            <div class="d-inline-flex">
                <p class="m-0"><a href="">Home</a></p>
                <p class="m-0 px-2">-</p>
                <p class="m-0">Checkout</p>
            </div>
        </div>
    </div>
    <!-- Page Header End -->

    <!-- Checkout Start -->
    <form role="form" action="/order/new" method="post" th:object="${orderForm}">
        <div class="container-fluid pt-5">
            <div class="row px-xl-5">
                <div class="col-lg-8">
                    <div class="mb-4">
                        <h4 class="font-weight-semi-bold mb-4">Billing Address</h4>
                        <div class="row">
                            <div class="col-md-2 form-group">
                                <input type="radio" id="self" name="address" checked onclick="initAddress('self')">
                                <label for="self">직접 입력</label>
                            </div>
                            <div class="col-md-2 form-group" th:each="address : ${addresses}">
                                <input type="radio" name="address" th:id="'r' + ${address.addressId}" th:onclick="initAddress(this.getAttribute('addressId'))" th:addressId="${address.addressId}">
                                <label th:text="${address.userAddressNickname}" th:for="'r' + ${address.addressId}"></label>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 form-group">
                                <label>이름</label>
                                <input class="form-control" type="text" name="receiverName" placeholder="John" th:value="${user.username}">
                            </div>
                            <div class="col-md-6 form-group">
                                <label>E-mail</label>
                                <input class="form-control" type="text" name="email" placeholder="example@email.com" th:value="${user.email}">
                            </div>
                            <div class="col-md-6 form-group">
                                <label>휴대폰 번호</label>
                                <input class="form-control" type="text" name="receiverPhone" placeholder="+123 456 789" th:value="${user.userPhone}">
                            </div>
                            <div class="col-md-6 form-group">
                                <label>우편번호</label>
                                <input class="form-control" type="text" name="receiverZipcode" placeholder="123" value="">
                            </div>
                            <div class="col-md-6 form-group">
                                <label>주소</label>
                                <input class="form-control" type="text" name="receiverAddress" placeholder="123 Street" value="">
                            </div>
                            <div class="col-md-6 form-group">
                                <label>상세 주소</label>
                                <input class="form-control" type="text" name="receiverAddressDetail" placeholder="123 Street" value="">
                            </div>
                        </div>
                        <script>
                            function initAddress(addressId){

                                if(addressId === 'self') {
                                    console.log(addressId);
                                    $("input[name=receiverName]").val("");
                                    $("input[name=email]").val("");
                                    $("input[name=receiverPhone]").val("");
                                    $("input[name=receiverZipcode]").val("");
                                    $("input[name=receiverAddress]").val("");
                                    $("input[name=receiverAddressDetail]").val("");
                                    //칸 비우기 로직
                                }else {
                                    $.ajax({
                                        url : "/order/address/"+ addressId,
                                        method : "GET",
                                        dataType : 'json'
                                    })
                                        .done(function(result){
                                            $("input[name=receiverZipcode]").val(result.userAddressZipcode);
                                            $("input[name=receiverAddress]").val(result.userAddress);
                                            $("input[name=receiverAddressDetail]").val(result.userAddressDetail);
                                        })
                                        .fail(function(xhr, status, errorThrown){
                                            $("#text").html("에러 발생 <br>")
                                                .append("오류명 : " + errorThrown + "<br>")
                                                .append("상태 : " + status)
                                        })
                                        .always(function (xhr, status){
                                            $("#text").html("요청이 완료되었습니다.")
                                        });
                                }
                            };
                        </script>
                    </div>
                </div>
                <div class="col-lg-4">
                    <div class="card border-secondary mb-5">
                        <div class="card-header bg-secondary border-0">
                            <h4 class="font-weight-semi-bold m-0">Order Total</h4>
                        </div>
                        <div class="card-body" th:each="good : ${goods}">
                            <input type="hidden" th:value="${good.goodsId}" name="goodsId">
                            <input type="hidden" th:value="${form.quantity}" name="orderCount">
                            <h5 class="font-weight-medium mb-3">Products</h5>
                            <div class="d-flex justify-content-between">
                                <p th:text="${good.goodsName}"></p>
                                <p th:text="${good.goodsPrice}"></p>
                            </div>

                            <hr class="mt-0">
                            <div class="d-flex justify-content-between mb-3 pt-1">
                                <h6 class="font-weight-medium">Subtotal</h6>
                                <h6 class="font-weight-medium" th:text="${good.goodsPrice} * ${form.quantity}"></h6>
                            </div>
                            <div class="d-flex justify-content-between">
                                <h6 class="font-weight-medium">Shipping</h6>
                                <h6 class="font-weight-medium">3500</h6>
                            </div>
                        </div>
                        <div class="card-footer border-secondary bg-transparent">
                            <div class="d-flex justify-content-between mt-2">
                                <h5 class="font-weight-bold">Total</h5>
                                <h5 class="font-weight-bold" th:text="${totalPrice}"></h5>
                            </div>
                        </div>
                    </div>
                    <div class="card border-secondary mb-5">
                        <div class="card-header bg-secondary border-0">
                            <h4 class="font-weight-semi-bold m-0">Payment</h4>
                        </div>
                        <div class="card-body">
                            <div class="form-group">
                                <div class="custom-control custom-radio">
                                    <input type="radio" class="custom-control-input" name="payment" id="paypal">
                                    <label class="custom-control-label" for="paypal">Paypal</label>
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="custom-control custom-radio">
                                    <input type="radio" class="custom-control-input" name="payment" id="directcheck">
                                    <label class="custom-control-label" for="directcheck">Direct Check</label>
                                </div>
                            </div>
                            <div class="">
                                <div class="custom-control custom-radio">
                                    <input type="radio" class="custom-control-input" name="payment" id="banktransfer">
                                    <label class="custom-control-label" for="banktransfer">Bank Transfer</label>
                                </div>
                            </div>
                        </div>
                        <div class="card-footer border-secondary bg-transparent">
                            <button class="btn btn-lg btn-block btn-primary font-weight-bold my-3 py-3">Place Order</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!--시큐리티 설정 전 임시로 사용하는 유저 id 얻는 스크립트-->
        <div style="visibility: hidden" id="secId" sec:authentication="principal.userId"></div>
        <input id="userId" type="hidden" name="userId" value="">
        <script>
            const secId = document.querySelector("#secId");
            const userId = document.querySelector("#userId");

            userId.value = secId.textContent;
        </script>
    </form>
    <!-- Checkout End -->


    <!-- Footer Start -->
    <div class="container-fluid bg-secondary text-dark mt-5 pt-5" th:replace="fragments/footer :: footer"></div>
    <!-- Footer End -->

    <!-- Back to Top -->
    <a href="#" class="btn btn-primary back-to-top"><i class="fa fa-angle-double-up"></i></a>
</body>

</html>